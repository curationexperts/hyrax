
<% if Hyrax.config.analytics_provider == 'google' %>
 
  function trackGooglePageView() {
    window._gaq.push(['_trackPageview']);
  }

  function trackGoogleEvents() {
    $('span.analytics-event').each(function(){
      var eventSpan = $(this)
      window._gaq.push(['_trackEvent', eventSpan.data('category'), eventSpan.data('action'), eventSpan.data('name')]); 
    })
  }

  if (typeof Turbolinks !== 'undefined') {
    $(document).on('turbolinks:load', function() {
      trackGooglePageView()
      trackGoogleEvents()
    })
  } else {
      $(document).on('ready', function() {
      trackGooglePageView()
      trackGoogleEvents()
    })
  }

  $(document).on('click', '#file_download', function(e) {
    _gaq.push(['_trackEvent', 'Files', 'Downloaded', $(this).data('label')]);
    _gaq.push(['_trackEvent', 'Works', 'Downloads', $(this).data('work-id')]);
    collection_ids.forEach(function (collection) {
      _gaq.push(['_trackEvent', 'Collections', 'Downloads', collection]);
      _gaq.push(['_trackEvent', 'Work in Collection', 'Downloads', collection]);
    });
  });

<% elsif Hyrax.config.analytics_provider == 'matomo' %>
  
   function trackMatomoPageView() {
    window._paq.push(['trackPageView']);
  }

  function trackMatomoEvents() {
    $('span.analytics-event').each(function(){
      var eventSpan = $(this)
      window._paq.push(['trackEvent', eventSpan.data('category'), eventSpan.data('action'), eventSpan.data('name')]); 
    })
  }

    if (typeof Turbolinks !== 'undefined') {
      $(document).on('turbolinks:load', function() {
          trackMatomoPageView()
          trackMatomoEvents()
      })
    } else {
          $(document).on('ready', function() {
            trackMatomoPageView()
            trackMatomoEvents()
        })
    }

    $(document).on('click', '#file_download', function(e) {
      _paq.push(['trackEvent', 'Files', 'Downloaded', $(this).data('label')]);
      _paq.push(['trackEvent', 'Works', 'Downloads', $(this).data('work-id')]);
      const collection_ids = $(this).data('collection-ids');
      collection_ids.forEach(function (collection) {
        _paq.push(['trackEvent', 'Collections', 'Downloads', collection]);
        _paq.push(['trackEvent', 'Work in Collection', 'Downloads', collection]);
      });
    });
<% end %>
